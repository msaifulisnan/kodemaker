<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Aplikasi Web Kustom - Desain Premium</title>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Font Inter dari Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Desain Profesional: Menggunakan skema warna Slate/Indigo dengan aksen Teal */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
            transition: background-color 0.3s;
        }
        .container-card {
            /* Lebih profesional dengan shadow yang halus dan terangkat */
            box-shadow: 0 20px 40px -15px rgba(2, 6, 23, 0.1), 0 0 10px -5px rgba(2, 6, 23, 0.05); /* custom slate shadow */
            border: 1px solid #e2e8f0; /* slate-200 border */
        }
        .form-input-style {
            /* Gaya input yang lebih bersih dan fokus yang kontras */
            transition: all 0.2s;
            border-color: #cbd5e1; /* slate-300 */
        }
        .form-input-style:focus {
            border-color: #14b8a6; /* teal-500 */
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.2);
        }
        .code-area {
            background-color: #1e293b; /* slate-800 */
            color: #f8fafc; /* slate-50 */
            border-radius: 0.75rem;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
        }
        /* Custom scrollbar style for the output area */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #64748b; /* slate-500 */
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #e2e8f0; /* slate-200 */
        }
        /* Animasi fade in untuk transisi form */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="p-4 sm:p-10">

    <div id="app" class="max-w-5xl mx-auto">
        <header class="text-center mb-12 bg-white p-6 rounded-3xl container-card">
            <div class="flex flex-col items-center justify-center mb-4">
                <!-- SVG sebagai Logo Pendukung -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-teal-500 mb-2" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15.75L6.25 13l1.5-1.5L11 15.25l5.25-5.25 1.5 1.5L11 17.75z"/>
                </svg>
                <h1 class="text-4xl sm:text-5xl font-extrabold text-indigo-800 tracking-tight">
                    <span class="text-teal-500">KODE</span>MAKER
                </h1>
            </div>
            <!-- Subtagline -->
            <p class="mt-3 text-lg text-slate-500 font-medium">Platform Generasi Aplikasi Web Kustom | Fokus pada Kualitas UI/UX</p>
        </header>

        <!-- Container Utama Input -->
        <div class="bg-white p-6 sm:p-10 rounded-3xl container-card mb-12">
            <!-- 1. Pemilihan Jenis Proyek -->
            <div class="border-b border-slate-200 pb-4 mb-8">
                <h2 class="text-2xl font-bold text-indigo-800">1. Jenis Proyek</h2>
                <p class="text-slate-500 text-sm mt-1">Pilih apakah Anda ingin membuat Web App interaktif atau Landing Page statis.</p>
                <div class="mt-4 max-w-sm">
                    <label for="projectType" class="block text-base font-semibold text-slate-700 mb-2">Pilih Tipe Output:</label>
                    <select id="projectType" onchange="toggleFormFields()" class="w-full p-3 form-input-style border rounded-xl bg-white text-slate-800 focus:ring-0">
                        <option value="webapp">Aplikasi Web (Web App) Interaktif</option>
                        <option value="landingpage">Landing Page / Halaman Promosi</option>
                    </select>
                </div>
            </div>

            <div class="border-b border-slate-200 pb-4 mb-8">
                <h2 class="text-2xl font-bold text-indigo-800">2. Rincian Proyek</h2>
                <p class="text-slate-500 text-sm mt-1">Isi rincian yang relevan dengan jenis proyek yang dipilih.</p>
            </div>
            
            <!-- Bidang untuk WEB APP -->
            <div id="webAppFields" class="space-y-6 fade-in">
                <!-- Nama Aplikasi -->
                <div>
                    <label for="appName" class="block text-base font-semibold text-slate-700 mb-2">Nama Aplikasi:</label>
                    <input type="text" id="appName" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Kalkulator Kecepatan Baca" value="Kalkulator Kecepatan Baca" required>
                </div>
                <!-- Area Input 2 Kolom -->
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Tujuan -->
                    <div>
                        <label for="appPurpose" class="block text-base font-semibold text-slate-700 mb-2">Tujuan Aplikasi (Mengapa dibuat?):</label>
                        <textarea id="appPurpose" rows="3" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Untuk membantu pengguna menghitung berapa banyak kata yang bisa mereka baca per menit." required>Untuk membantu pengguna menghitung berapa banyak kata yang bisa mereka baca per menit (WPM).</textarea>
                    </div>
                    <!-- Output -->
                    <div>
                        <label for="appOutput" class="block text-base font-semibold text-slate-700 mb-2">Output yang Diharapkan (Penekanan UI):</label>
                        <textarea id="appOutput" rows="3" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Tampilkan hasil di card besar yang menonjol dan beranimasi saat muncul." required>Tampilkan hasil dalam kartu besar yang menonjol dengan WPM, dan juga waktu yang dibutuhkan untuk membaca 1000 kata.</textarea>
                    </div>
                </div>
                <!-- Alur / Fungsionalitas -->
                <div>
                    <label for="appFlow" class="block text-base font-semibold text-slate-700 mb-2">Alur Utama / Fungsionalitas (Bagaimana cara kerjanya?):</label>
                    <textarea id="appFlow" rows="3" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Input total kata dan waktu baca (detik). Klik hitung. Tampilkan hasilnya dalam WPM." required>Pengguna memasukkan total kata dalam teks (angka) dan waktu yang dibutuhkan untuk membaca teks tersebut (dalam menit atau detik). Klik tombol 'Hitung'. Hasil WPM dihitung: (Total Kata / Total Waktu dalam Menit). Hasil ditampilkan.</textarea>
                </div>
            </div>

            <!-- Bidang untuk LANDING PAGE -->
            <div id="landingPageFields" class="space-y-6 hidden fade-in">
                 <!-- Nama Produk -->
                <div>
                    <label for="lpProductName" class="block text-base font-semibold text-slate-700 mb-2">Nama Produk / Layanan:</label>
                    <input type="text" id="lpProductName" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Aplikasi Keuangan 'FinanPro'" required>
                </div>
                 <!-- Hero / Value Proposition -->
                <div>
                    <label for="lpValueProp" class="block text-base font-semibold text-slate-700 mb-2">Proposisi Nilai Utama (Headline Hero):</label>
                    <textarea id="lpValueProp" rows="2" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Kelola uang Anda secara otomatis dan raih kebebasan finansial dalam 90 hari." required></textarea>
                </div>
                <!-- Target & Fitur (2 Kolom) -->
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Target Audiens -->
                    <div>
                        <label for="lpAudience" class="block text-base font-semibold text-slate-700 mb-2">Target Audiens & Tone:</label>
                        <textarea id="lpAudience" rows="3" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Profesional muda, tone harus meyakinkan, profesional, dan sedikit mendesak." required></textarea>
                    </div>
                    <!-- Fitur Kunci -->
                    <div>
                        <label for="lpKeyFeatures" class="block text-base font-semibold text-slate-700 mb-2">Fitur Kunci (Pisahkan dengan baris baru):</label>
                        <textarea id="lpKeyFeatures" rows="3" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh:
Pelacakan pengeluaran real-time
Anggaran berbasis AI
Laporan keuangan bulanan otomatis" required></textarea>
                        <p class="text-xs text-slate-400 mt-1">Masukkan 3 hingga 5 poin fitur utama.</p>
                    </div>
                </div>
                
                <!-- URL Gambar Produk (Multi-line) - DYNAMIC INPUTS START HERE -->
                <div>
                    <label class="block text-base font-semibold text-slate-700 mb-2">
                        Daftar Gambar Produk/Aplikasi
                    </label>
                    <!-- Header Input Dinamis -->
                    <div class="flex flex-row gap-2 font-medium text-xs text-slate-500 mb-2">
                        <span class="w-full sm:w-2/3">URL Gambar</span>
                        <span class="w-full sm:w-1/3">Posisi/Fungsi (misal: hero, galeri-1)</span>
                        <span class="w-10"></span>
                    </div>

                    <div id="imageInputContainer" class="space-y-3 p-4 border border-slate-300 rounded-xl bg-slate-50">
                        <!-- Baris Gambar Pertama akan diisi oleh addImageInputRow() di awal -->
                    </div>
                    
                    <button type="button" onclick="addImageInputRow()" class="mt-3 flex items-center px-4 py-2 text-sm font-semibold rounded-xl text-teal-600 bg-teal-50 hover:bg-teal-100 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                        Tambahkan Gambar Lain
                    </button>
                    <p class="text-xs text-red-500 mt-2">**PENTING:** Harus ada setidaknya satu gambar. Pastikan URL dapat diakses publik.</p>
                </div>
                <!-- DYNAMIC INPUTS END HERE -->

                <!-- Ulasan & Garansi (2 Kolom) -->
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Ulasan/Testimoni -->
                    <div>
                        <label for="lpTestimonials" class="block text-base font-semibold text-slate-700 mb-2">Ulasan / Testimoni Kunci (Opsional):</label>
                        <textarea id="lpTestimonials" rows="3" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: 'Ini mengubah hidup finansial saya!' - John Doe (Sertakan 1-3 ulasan, pisahkan dengan baris baru)"></textarea>
                    </div>
                    <!-- Jaminan Produk -->
                    <div>
                        <label for="lpGuarantee" class="block text-base font-semibold text-slate-700 mb-2">Jaminan Produk / Garansi (Opsional):</label>
                        <input type="text" id="lpGuarantee" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Garansi Uang Kembali 30 Hari Tanpa Ribet">
                    </div>
                </div>

                <!-- CTA (2 Kolom) -->
                 <div class="grid md:grid-cols-2 gap-6">
                    <!-- Teks CTA -->
                    <div>
                        <label for="lpCTAText" class="block text-base font-semibold text-slate-700 mb-2">Teks Tombol CTA Utama:</label>
                        <input type="text" id="lpCTAText" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Mulai Uji Coba Gratis Sekarang" required>
                    </div>
                    <!-- Link CTA -->
                    <div>
                        <label for="lpCTALink" class="block text-base font-semibold text-slate-700 mb-2">Link Tujuan CTA (URL Penuh):</label>
                        <input type="url" id="lpCTALink" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: https://app.produkanda.com/daftar" required>
                    </div>
                </div>
            </div>

            <!-- Bagian Kustomisasi Desain (Shared by both) -->
            <div class="border-b border-slate-200 pb-4 mb-8 mt-12">
                <h2 class="text-2xl font-bold text-indigo-800">3. Kustomisasi Desain & Fitur</h2>
                <p class="text-slate-500 text-sm mt-1">Atur gaya dan tambahkan fungsionalitas lanjutan.</p>
            </div>
            
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Preferensi Gaya: Font -->
                <div>
                    <label for="fontPreference" class="block text-base font-semibold text-slate-700 mb-2">Preferensi Font:</label>
                    <select id="fontPreference" class="w-full p-3 form-input-style border rounded-xl bg-white text-slate-800 focus:ring-0">
                        <option value="Inter, sans-serif" selected>Inter (Modern & Jelas)</option>
                        <option value="Roboto, sans-serif">Roboto (Standar Android)</option>
                        <option value="Montserrat, sans-serif">Montserrat (Geometris Kuat)</option>
                        <option value="Poppins, sans-serif">Poppins (Bulat & Ceria)</option>
                        <option value="Lora, serif">Lora (Klasik & Elegan)</option>
                        <option value="Source Code Pro, monospace">Source Code Pro (Gaya Kode)</option>
                    </select>
                </div>
                <!-- Preferensi Gaya: Warna -->
                <div>
                    <label for="colorScheme" class="block text-base font-semibold text-slate-700 mb-2">Skema Warna Utama:</label>
                    <select id="colorScheme" class="w-full p-3 form-input-style border rounded-xl bg-white text-slate-800 focus:ring-0">
                        <option value="Teal Kontras (Teal & Indigo)" selected>Teal Kontras (Teal & Indigo)</option>
                        <option value="Biru Ceria (Blue & Teal)">Biru Ceria (Blue & Teal)</option>
                        <option value="Hijau Alam (Green & Olive)">Hijau Alam (Green & Olive)</option>
                        <option value="Merah Bata (Red & Brown)">Merah Bata (Red & Brown)</option>
                        <option value="Ungu Elegan (Purple & Pink)">Ungu Elegan (Purple & Pink)</option>
                        <option value="Abu-abu Minimalis (Gray & White)">Abu-abu Minimalis (Gray & White)</option>
                    </select>
                </div>
                <!-- Credit Kustom -->
                <div>
                    <label for="customCredit" class="block text-base font-semibold text-slate-700 mb-2">Teks Credit Footer Kustom:</label>
                    <input type="text" id="customCredit" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Dibuat oleh [Nama Anda] | Versi 1.0">
                    <p class="text-xs text-slate-400 mt-1">Wajib ada footer. Kosongkan untuk credit default.</p>
                </div>
            </div>

            <!-- Instruksi Styling Kustom (Baru) -->
            <div class="mt-8">
                <label for="customCSSInstruction" class="block text-base font-semibold text-slate-700 mb-2">Instruksi Styling CSS Tambahan (Opsional):</label>
                <textarea id="customCSSInstruction" rows="2" class="w-full p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" placeholder="Contoh: Buat header 'sticky' agar tetap terlihat saat scroll. Warna latar belakang keseluruhan harus sangat terang."></textarea>
                <p class="text-xs text-slate-400 mt-1">Gunakan ini untuk permintaan desain yang sangat spesifik yang tidak tercakup oleh font/warna di atas.</p>
            </div>


            <!-- Fitur Opsional Tambahan -->
            <div class="mt-10">
                <label class="block text-base font-semibold text-slate-700 mb-4">Pilihan Fitur Lanjutan:</label>
                <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-y-4 gap-x-6">
                    <div class="flex items-center">
                        <input id="featureResponsive" type="checkbox" value="Desain harus sepenuhnya Responsif (Mobile-first)." class="h-5 w-5 text-teal-600 border-slate-300 rounded-lg focus:ring-teal-500" checked>
                        <label for="featureResponsive" class="ml-3 text-slate-700 text-sm select-none">Responsif Penuh (Mobile & Desktop)</label>
                    </div>
                    <div class="flex items-center">
                        <input id="featureDarkMode" type="checkbox" value="Sertakan tombol untuk mengaktifkan Dark Mode." class="h-5 w-5 text-teal-600 border-slate-300 rounded-lg focus:ring-teal-500">
                        <label for="featureDarkMode" class="ml-3 text-slate-700 text-sm select-none">Tombol Dark Mode</label>
                    </div>
                    <div class="flex items-center">
                        <input id="featureAnimation" type="checkbox" value="Sertakan transisi dan animasi CSS yang halus pada interaksi utama, seperti efek hover dan fade in." class="h-5 w-5 text-teal-600 border-slate-300 rounded-lg focus:ring-teal-500" checked>
                        <label for="featureAnimation" class="ml-3 text-slate-700 text-sm select-none">Animasi & Transisi Halus</label>
                    </div>
                    <!-- Fitur yang hanya relevan untuk Web App, sembunyikan untuk Landing Page -->
                    <div id="featureLocalStorageContainer" class="flex items-center">
                        <input id="featureLocalStorage" type="checkbox" value="Gunakan LocalStorage di browser untuk menyimpan data sederhana (misalnya, hasil terakhir)." class="h-5 w-5 text-teal-600 border-slate-300 rounded-lg focus:ring-teal-500">
                        <label for="featureLocalStorage" class="ml-3 text-slate-700 text-sm select-none">Penyimpanan LocalStorage (Hanya Web App)</label>
                    </div>
                    <div id="featureValidationContainer" class="flex items-center">
                        <input id="featureValidation" type="checkbox" value="Sertakan validasi input dasar dengan pesan error yang ramah pengguna." class="h-5 w-5 text-teal-600 border-slate-300 rounded-lg focus:ring-teal-500" checked>
                        <label for="featureValidation" class="ml-3 text-slate-700 text-sm select-none">Validasi Input Form (Hanya Web App)</label>
                    </div>
                    <div id="featureCopyButtonContainer" class="flex items-center">
                        <input id="featureCopyButton" type="checkbox" value="Sertakan tombol untuk menyalin output hasil ke clipboard." class="h-5 w-5 text-teal-600 border-slate-300 rounded-lg focus:ring-teal-500" checked>
                        <label for="featureCopyButton" class="ml-3 text-slate-700 text-sm select-none">Tombol Salin Hasil (Hanya Web App)</label>
                    </div>
                </div>
            </div>

            <!-- Tombol Generate -->
            <button id="generateBtn" onclick="generateWebapp()" class="mt-10 w-full flex items-center justify-center px-8 py-4 border border-transparent text-xl font-bold rounded-xl text-white bg-teal-500 hover:bg-teal-600 focus:outline-none focus:ring-4 focus:ring-offset-2 focus:ring-teal-400 focus:ring-offset-white transition duration-200 ease-in-out shadow-lg shadow-teal-500/50 hover:shadow-xl hover:shadow-teal-500/60">
                <svg id="spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span id="buttonText">BUAT KODE</span>
            </button>
        </div>

        <!-- Area Output -->
        <div id="outputSection" class="bg-white p-6 sm:p-8 rounded-3xl container-card hidden">
            <h2 class="text-2xl font-bold text-indigo-800 mb-6 border-b border-slate-200 pb-3">4. Kode Aplikasi Anda (Hasil Generasi)</h2>
            <div id="errorMessage" class="hidden bg-red-50 border border-red-300 text-red-700 px-4 py-3 rounded-xl relative mb-4 font-medium" role="alert">
                <strong class="font-bold mr-1">Error Generasi!</strong>
                <span class="block sm:inline" id="errorContent">Terjadi kesalahan saat membuat kode. Coba lagi atau perbaiki ide Anda.</span>
            </div>
            <textarea id="outputCode" readonly rows="20" class="w-full p-6 code-area font-mono text-sm custom-scrollbar resize-none" placeholder="Kode HTML yang dihasilkan akan muncul di sini..."></textarea>
            
            <button onclick="copyCode()" class="mt-4 px-6 py-2 text-base font-semibold rounded-xl text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-offset-2 focus:ring-green-500 focus:ring-offset-white transition duration-150 ease-in-out">
                Salin Kode ke Clipboard
            </button>
            <span id="copyMessage" class="ml-3 text-base text-green-600 opacity-0 transition-opacity duration-300">Berhasil disalin! ðŸŽ‰</span>
        </div>

        <!-- Footer yang ditingkatkan untuk visibilitas mobile -->
        <footer class="text-center mt-12">
            <p class="font-semibold text-sm text-slate-600 mb-1">Developed by saipulisnan.ai</p>
            <p class="text-xs text-slate-500">Â© 2025 KODEMAKER Generator. | Didukung oleh Gemini API.</p>
        </footer>
    </div>

    <script>
        // Variabel global untuk API
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- ELEMEN UI ---
        const projectTypeSelect = document.getElementById('projectType');

        // Web App Fields
        const webAppFields = document.getElementById('webAppFields');
        const appNameInput = document.getElementById('appName');
        const appPurposeInput = document.getElementById('appPurpose');
        const appFlowInput = document.getElementById('appFlow');
        const appOutputInput = document.getElementById('appOutput');

        // Landing Page Fields
        const landingPageFields = document.getElementById('landingPageFields');
        const lpProductNameInput = document.getElementById('lpProductName');
        const lpValuePropInput = document.getElementById('lpValueProp');
        const lpAudienceInput = document.getElementById('lpAudience');
        const lpKeyFeaturesInput = document.getElementById('lpKeyFeatures');
        const imageInputContainer = document.getElementById('imageInputContainer'); 
        const lpTestimonialsInput = document.getElementById('lpTestimonials');
        const lpGuaranteeInput = document.getElementById('lpGuarantee');
        const lpCTATextInput = document.getElementById('lpCTAText');
        const lpCTALinkInput = document.getElementById('lpCTALink');
        
        // Shared Fields
        const fontPreferenceSelect = document.getElementById('fontPreference');
        const colorSchemeSelect = document.getElementById('colorScheme');
        const customCSSInstructionInput = document.getElementById('customCSSInstruction'); 
        const featureCheckboxes = document.querySelectorAll('input[type="checkbox"]');
        const customCreditInput = document.getElementById('customCredit');
        const featureLocalStorageContainer = document.getElementById('featureLocalStorageContainer');
        const featureValidationContainer = document.getElementById('featureValidationContainer');
        const featureCopyButtonContainer = document.getElementById('featureCopyButtonContainer');
        
        const generateBtn = document.getElementById('generateBtn');
        const buttonText = document.getElementById('buttonText');
        const spinner = document.getElementById('spinner');
        const outputSection = document.getElementById('outputSection');
        const outputCodeArea = document.getElementById('outputCode');
        const errorMessage = document.getElementById('errorMessage');
        const errorContent = document.getElementById('errorContent');
        const copyMessage = document.getElementById('copyMessage');

        // Fungsi untuk menambahkan baris input gambar baru
        function addImageInputRow(url = '', position = '') {
            const newRow = document.createElement('div');
            newRow.className = 'flex flex-col sm:flex-row gap-2 items-center fade-in';
            newRow.setAttribute('data-image-row', '');
            newRow.innerHTML = `
                <input type="url" value="${url}" placeholder="URL Gambar (misal: https://cdn.com/product.jpg)" class="w-full sm:w-2/3 p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" name="lpImageURL" required>
                <input type="text" value="${position}" placeholder="Posisi/Fungsi (misal: hero, galeri-1, testimonial)" class="w-full sm:w-1/3 p-3 form-input-style border rounded-xl focus:ring-0 text-slate-800" name="lpImagePosition" required>
                <button type="button" onclick="removeImageInputRow(this)" class="p-2 sm:w-10 flex items-center justify-center bg-red-100 hover:bg-red-200 text-red-600 rounded-xl transition duration-150 flex-shrink-0" aria-label="Hapus Gambar">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                </button>
            `;
            imageInputContainer.appendChild(newRow);
        }

        // Fungsi untuk menghapus baris input gambar
        function removeImageInputRow(buttonElement) {
            const row = buttonElement.closest('[data-image-row]');
            if (row) {
                // Pastikan minimal ada 1 baris tersisa
                if (imageInputContainer.querySelectorAll('[data-image-row]').length > 1) {
                    row.remove();
                } else {
                    // Gunakan modal/pesan error yang lebih baik, bukan alert()
                    showError('Minimal harus ada satu gambar produk.');
                }
            }
        }
        
        // Fungsi untuk menampilkan pesan error di UI (pengganti alert)
        function showError(message) {
             errorContent.textContent = message;
             errorMessage.classList.remove('hidden');
        }

        // Fungsi untuk mengaktifkan/menonaktifkan loading state
        function setLoading(isLoading) {
            generateBtn.disabled = isLoading;
            if (isLoading) {
                spinner.classList.remove('hidden');
                buttonText.innerHTML = 'Membuat Kode... Mohon tunggu sebentar';
                generateBtn.classList.remove('bg-teal-500', 'hover:bg-teal-600', 'shadow-lg');
                generateBtn.classList.add('bg-teal-400', 'cursor-not-allowed');
                errorMessage.classList.add('hidden');
                generateBtn.focus();
            } else {
                spinner.classList.add('hidden');
                buttonText.innerHTML = 'BUAT KODE';
                generateBtn.classList.remove('bg-teal-400', 'cursor-not-allowed');
                generateBtn.classList.add('bg-teal-500', 'hover:bg-teal-600', 'shadow-lg');
            }
        }
        
        // Fungsi untuk mengganti tampilan form berdasarkan Project Type
        function toggleFormFields() {
            const type = projectTypeSelect.value;
            
            if (type === 'webapp') {
                webAppFields.classList.remove('hidden');
                webAppFields.classList.add('fade-in');
                landingPageFields.classList.add('hidden');
                featureLocalStorageContainer.classList.remove('hidden');
                featureValidationContainer.classList.remove('hidden');
                featureCopyButtonContainer.classList.remove('hidden');
            } else if (type === 'landingpage') {
                webAppFields.classList.add('hidden');
                landingPageFields.classList.remove('hidden');
                landingPageFields.classList.add('fade-in');
                featureLocalStorageContainer.classList.add('hidden');
                featureValidationContainer.classList.add('hidden');
                featureCopyButtonContainer.classList.add('hidden');

                // Tambahkan baris input gambar default jika kosong
                if (imageInputContainer.querySelectorAll('[data-image-row]').length === 0) {
                    // Tambahkan placeholder URL gambar contoh
                    addImageInputRow('https://placehold.co/400x300/14b8a6/ffffff?text=Produk+Hero', 'hero');
                }
            }
            // Clear previous error messages on toggle
            errorMessage.classList.add('hidden');
        }

        // Jalankan fungsi saat startup untuk memastikan tampilan awal sudah benar
        document.addEventListener('DOMContentLoaded', toggleFormFields);

        // Fungsi utama untuk memanggil Gemini API
        async function generateWebapp() {
            setLoading(true);
            outputSection.classList.add('hidden');
            outputCodeArea.value = '';

            const projectType = projectTypeSelect.value;
            let userQuery = "";
            let requiredFieldsValid = true;

            // --- VALIDASI DAN PEMBENTUKAN QUERY UNTUK WEB APP ---
            if (projectType === 'webapp') {
                const appName = appNameInput.value.trim();
                const appPurpose = appPurposeInput.value.trim();
                const appFlow = appFlowInput.value.trim();
                const appOutput = appOutputInput.value.trim();

                if (!appName || !appPurpose || !appFlow || !appOutput) {
                    showError('Semua bidang Rincian Aplikasi (Nama, Tujuan, Alur, Output) wajib diisi.');
                    requiredFieldsValid = false;
                } else {
                    userQuery = `Buatkan aplikasi web HTML satu file tunggal dengan nama '${appName}'.
Tujuan: ${appPurpose}.
Alur / Fungsionalitas Utama: ${appFlow}.
Output yang Diharapkan: ${appOutput} (Terapkan tata letak output untuk visibilitas dan UX terbaik, misalnya menggunakan kartu atau modal yang menonjol).`;
                }
            } 
            // --- VALIDASI DAN PEMBENTUKAN QUERY UNTUK LANDING PAGE ---
            else if (projectType === 'landingpage') {
                const lpProductName = lpProductNameInput.value.trim();
                const lpValueProp = lpValuePropInput.value.trim();
                const lpAudience = lpAudienceInput.value.trim();
                const lpKeyFeatures = lpKeyFeaturesInput.value.trim();
                const lpTestimonials = lpTestimonialsInput.value.trim();
                const lpGuarantee = lpGuaranteeInput.value.trim();
                const lpCTAText = lpCTATextInput.value.trim();
                const lpCTALink = lpCTALinkInput.value.trim();
                
                // Cek fields wajib lainnya
                if (!lpProductName || !lpValueProp || !lpAudience || !lpKeyFeatures || !lpCTAText || !lpCTALink) {
                    showError('Semua bidang Rincian Landing Page wajib diisi.');
                    requiredFieldsValid = false;
                } 

                // --- Pengumpulan Data Gambar Dinamis ---
                const imageRows = imageInputContainer.querySelectorAll('[data-image-row]');
                const imageList = [];
                let hasValidImage = false;

                imageRows.forEach(row => {
                    const urlInput = row.querySelector('input[name="lpImageURL"]');
                    const positionInput = row.querySelector('input[name="lpImagePosition"]');

                    if (urlInput.value.trim() && positionInput.value.trim()) {
                         imageList.push(`[URL: ${urlInput.value.trim()} | POSISI/FUNGSI: ${positionInput.value.trim()}]`);
                         hasValidImage = true;
                    } else if (urlInput.value.trim() || positionInput.value.trim()) {
                        // Jika salah satu terisi tapi yang lain kosong
                        requiredFieldsValid = false;
                    }
                });

                if (!requiredFieldsValid) {
                     showError('Semua baris Gambar harus memiliki URL dan Posisi/Fungsi yang terisi.');
                }
                
                if (!hasValidImage && requiredFieldsValid) { // Cek gambar hanya jika field lain sudah valid
                    showError('Setidaknya satu URL Gambar Produk dan Posisi/Fungsi wajib diisi.');
                    requiredFieldsValid = false;
                }

                if (requiredFieldsValid) {
                    const imageListFormatted = imageList.join('\n');
                    
                     userQuery = `Buatkan Landing Page HTML satu file tunggal untuk produk/layanan: '${lpProductName}'.
Proposisi Nilai Utama (Headline Hero): ${lpValueProp}.
Target Audiens & Tone: ${lpAudience}.
Fitur Kunci (Gunakan 3-5 seksi yang menonjol): ${lpKeyFeatures}.
GAMBAR PRODUK DAN POSISI YANG DIMINTA: Gunakan SEMUA data gambar berikut sesuai dengan POSISI/FUNGSI yang ditunjuk. Jika ada beberapa gambar untuk "galeri", buat tata letak grid/galeri yang menarik dan responsif:
---
${imageListFormatted}
---
Call-to-Action (CTA): Tombol utama bertuliskan '${lpCTAText}' dan mengarah ke URL: '${lpCTALink}'.`;

                    if (lpTestimonials) {
                        userQuery += `\nUlasan/Testimoni untuk disertakan: ${lpTestimonials}. Buatlah bagian Testimoni yang menonjol.`;
                    }
                    if (lpGuarantee) {
                         userQuery += `\nSertakan jaminan produk/garansi sebagai Risk Reversal: ${lpGuarantee}. Buat ini menonjol di dekat CTA.`;
                    }
                    
                    userQuery += `\nPastikan halaman memiliki navigasi header sederhana, bagian hero yang kuat, bagian fitur terpisah, Testimoni (jika ada), Garansi (jika ada), dan footer. Fokus pada konversi dan estetika modern.`;
                }
            }

            if (!requiredFieldsValid) {
                setLoading(false);
                return;
            }

            // --- PENGUMPULAN DATA UMUM (SHARED) ---
            const fontPref = fontPreferenceSelect.value;
            const colorScheme = colorSchemeSelect.value;
            let customCredit = customCreditInput.value.trim();
            const customCSSInstruction = customCSSInstructionInput.value.trim(); 
            
            // Mengumpulkan fitur opsional
            const selectedFeatures = Array.from(featureCheckboxes)
                .filter(cb => {
                    // Hanya sertakan fitur App-specific jika proyeknya adalah Web App
                    if (projectType === 'landingpage' && 
                       (cb.id === 'featureLocalStorage' || cb.id === 'featureValidation' || cb.id === 'featureCopyButton')) {
                        return false;
                    }
                    return cb.checked;
                })
                .map(cb => cb.value)
                .join(', ');

            // Tentukan instruksi footer
            const defaultCredit = 'Hak Cipta Â© 2025. Dibuat dengan kecerdasan buatan Gemini API.';
            
            if (customCredit) {
                if (!customCredit.includes('Gemini API')) {
                    customCredit += ' | Didukung oleh Gemini API.';
                }
            } else {
                 customCredit = defaultCredit;
            }
            
            const footerInstruction = `Footer wajib ada dan harus menyertakan teks credit: '${customCredit}'.`;
            
            const featuresText = (selectedFeatures ? 'Fitur Tambahan: ' + selectedFeatures : 'Tidak ada fitur opsional tambahan.') + `. ${footerInstruction}`;

            // Tambahkan Estetika dan Fitur ke Query
            userQuery += `\n\nEstetika: Gunakan font '${fontPref}' dan skema warna '${colorScheme}' (sebagai warna utama/aksen).
Kebutuhan Desain/Fitur Lain: ${featuresText}.`;
            
            if (customCSSInstruction) {
                userQuery += `\nINSTRUKSI STYLING CSS SPESIFIK: ${customCSSInstruction}. Terapkan instruksi ini menggunakan blok <style> CSS KUSTOM di dalam kode.`;
            }


            // System Instruction untuk memandu model (Penekanan SANGAT KUAT pada UI/UX)
            const systemPrompt = `Anda adalah pengembang HTML, CSS (Tailwind), dan JavaScript ahli kelas dunia. Tugas Anda adalah membuat ${projectType === 'webapp' ? 'Aplikasi Web Interaktif' : 'Landing Page Konversi Tinggi'} mandiri satu file tunggal yang lengkap dan berfungsi berdasarkan permintaan pengguna.
            
Instruksi Kritis Desain (WAJIB DIPATUHI UNTUK KUALITAS OUTPUT):
1. Outputnya HARUS berupa satu dokumen HTML yang terstruktur dengan baik, menyertakan semua styling (Tailwind CSS CDN) dan JavaScript.
2. KODE HARUS MOBILE-FIRST, SANGAT RESPONSIVE, dan memiliki KUALITAS UI/UX TINGGI (bersih, modern, elegan, estetis, mudah dinavigasi). Pastikan TIDAK ADA overflow/horizontal scroll di perangkat seluler.
3. Pastikan SEMUA gambar yang digunakan bersifat fleksibel (misalnya max-w-full, h-auto). Gunakan placeholder image URL default jika URL dari pengguna tidak dapat diakses atau kosong.
4. Semua elemen interaktif (terutama tombol CTA pada Landing Page) harus menonjol, memiliki ukuran sentuh yang memadai (minimal 48x48px) untuk perangkat seluler.
5. Jika ada instruksi styling CSS kustom, Anda harus membuatnya sebagai CSS di dalam tag <style> dan menambahkannya di bagian <head>.

Output HARUS dimulai dan diakhiri dengan blok kode Markdown tunggal untuk file HTML. JANGAN sertakan teks pengantar atau penutup apa pun di luar blok kode.`;


            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            let response = null;
            let attempts = 0;
            const maxAttempts = 3;
            let lastError = null;

            // Logika exponential backoff untuk mencoba kembali
            while (attempts < maxAttempts) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        break; // Berhasil, keluar dari loop
                    } else {
                        // Logika untuk error HTTP
                        lastError = `HTTP error! status: ${response.status}`;
                        throw new Error(lastError);
                    }
                } catch (error) {
                    attempts++;
                    lastError = error.message;
                    if (attempts < maxAttempts) {
                        const delay = Math.pow(2, attempts) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } 
                }
            }

            if (!response || !response.ok) {
                setLoading(false);
                showError(`Gagal menghubungi API setelah ${maxAttempts} percobaan. Kesalahan terakhir: ${lastError}`);
                return;
            }


            setLoading(false);
            
            try {
                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    let text = candidate.content.parts[0].text;
                    
                    // Ekstraksi kode dari blok markdown (wajib)
                    const match = text.match(/```html\n([\s\S]*?)\n```/);
                    let generatedCode = match ? match[1] : text;

                    generatedCode = generatedCode.trim();

                    if (generatedCode.startsWith('<!DOCTYPE html>')) {
                         outputCodeArea.value = generatedCode;
                         outputSection.classList.remove('hidden');
                    } else {
                         outputCodeArea.value = generatedCode; 
                         showError('Output tidak dimulai dengan <!DOCTYPE html>. Gemini menghasilkan respons yang tidak sesuai format. Silakan periksa atau coba ide lain.');
                         outputSection.classList.remove('hidden');
                    }

                } else {
                    showError('Respon API tidak memiliki konten. Model mungkin menolak permintaan. Coba buat ide yang lebih sederhana atau jelas.');
                }
            } catch (e) {
                showError('Kesalahan tak terduga saat memproses respons API: ' + e.message);
            }
        }

        // Fungsi untuk menyalin kode ke clipboard
        function copyCode() {
            outputCodeArea.select();
            outputCodeArea.setSelectionRange(0, 99999); 
            try {
                document.execCommand('copy'); 
                copyMessage.classList.remove('opacity-0');
                copyMessage.classList.add('opacity-100');
                setTimeout(() => {
                    copyMessage.classList.remove('opacity-100');
                    copyMessage.classList.add('opacity-0');
                }, 2000);
            } catch (err) {
                console.error('Gagal menyalin:', err);
            }
        }
    </script>
</body>
</html>
